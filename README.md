#  MHiT DB í”„ë¡œì íŠ¸
<p align="center">
<img width="512" height="512" alt="mhit1" src="https://github.com/user-attachments/assets/d171ae7d-de76-44a6-a458-1e431794b067" />
</p>

<div align="center">

# âš¾ ì•¼êµ¬ ì˜ˆë§¤ì™€ ì…”í‹€ ì˜ˆì•½ì„ í•œ ë²ˆì—! ğŸšŒ

</div>



&nbsp;

---

**íŒ€ì›**

ê¹€ë„ê· , ê¹€íƒœí™˜, í™©ì •ìœ¤, í™ì§„í¬

---

## ğŸ“Œ í”„ë¡œì íŠ¸ ê°œìš”  

- **MHiT** : ì‚¬ìš©ìê°€ ì›í•˜ëŠ” ì•¼êµ¬ ê²½ê¸°ë¥¼ ì˜ˆë§¤í•  ë•Œ ê·¼ë°©ì—ì„œ í•´ë‹¹ ê²½ê¸°ì¥ê¹Œì§€ ìš´í–‰í•˜ëŠ” ì…”í‹€ ë²„ìŠ¤ê¹Œì§€ ì˜ˆì•½í•  ìˆ˜ ìˆëŠ” DB ì¤‘ì‹¬ì˜ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.

- ì‹¤ì œ ì„œë¹„ìŠ¤ ìš´ì˜ì— ì í•©í•œ **ERD**ë¥¼ ì„¤ê³„í•˜ê³ , **SQL ì¿¼ë¦¬ì™€ í”„ë¡œì‹œì €ê°€ ìš”êµ¬ì‚¬í•­ëŒ€ë¡œ ì •í™•í•˜ê²Œ ì‹¤í–‰ë˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸**í•˜ëŠ” ë° ì¤‘ì ì„ ë‘ì—ˆìŠµë‹ˆë‹¤.

---

## ìŠ¤íƒ
<p>
<img src="https://img.shields.io/badge/mariaDB-003545?style=for-the-badge&logo=mariaDB&logoColor=white">
<img src="https://img.shields.io/badge/mysql-4479A1?style=for-the-badge&logo=mysql&logoColor=white">
<img src="https://img.shields.io/badge/visualstudiocode-007ACC?style=for-the-badge&logo=visualstudiocode&logoColor=white">
<img src="https://img.shields.io/badge/git-F05032?style=for-the-badge&logo=git&logoColor=white">
<img src="https://img.shields.io/badge/github-181717?style=for-the-badge&logo=github&logoColor=white">
<img src="https://img.shields.io/badge/discord-5865F2?style=for-the-badge&logo=discord&logoColor=white">
</p>

---

## ğŸ“… í”„ë¡œì íŠ¸ ê¸°ê°„  

**2025.12.04 ~ 2025.12.05**

---

## ğŸ§­ ì§„í–‰íë¦„ë„
<img width="1484" height="425" alt="MHIT 2" src="https://github.com/user-attachments/assets/ff7af975-6909-43aa-96db-d8936c257cb0" />



---

## âœ¨ ì£¼ìš” ê¸°ëŠ¥

| ê¸°ëŠ¥ êµ¬ë¶„ | ìƒì„¸ ê¸°ëŠ¥ |
|----------|-----------|
| ğŸŸ **ê²½ê¸° ì˜ˆë§¤** | - êµ¬ë‹¨ ê¸°ì¤€ ê²½ê¸° ê²€ìƒ‰ <br> - ì¢Œì„ ê¸°ë°˜ ì˜ˆë§¤ ê¸°ëŠ¥ <br> - ê²½ê¸° ì˜ˆë§¤ ë‚´ì—­ ì¡°íšŒ |
| ğŸšŒ **ì…”í‹€ë²„ìŠ¤ ì˜ˆì•½** | - ê²½ê¸° ì¼ì •ê³¼ ì—°ë™ëœ ì…”í‹€ë²„ìŠ¤ ë…¸ì„  ì¡°íšŒ <br> -  ì´ìš© ê°€ëŠ¥ ë²„ìŠ¤ ì •ë³´ ì¡°íšŒ |
| ğŸŸ **êµ¬ë‹¨ ì¡°íšŒ** | - êµ¬ë‹¨ ê¸°ë³¸ ì •ë³´ ì¡°íšŒ <br> - êµ¬ë‹¨ ê²½ê¸° ì¼ì • ì¡°íšŒ <br> - êµ¬ë‹¨ ìŠ¹ë¥ , ì„ í˜¸ íŒ¬ ìˆ˜ ì¡°íšŒ |
| âš¾ **ê²½ê¸° ì¡°íšŒ** | - ì „ì²´ ê²½ê¸° ì¼ì • ì¡°íšŒ <br> - íŠ¹ì • êµ¬ë‹¨ ê²½ê¸° ì¡°íšŒ <br> - ê²½ê¸° ê²°ê³¼(ìŠ¹/ë¬´/íŒ¨), ê²½ê¸° ìƒíƒœ í™•ì¸ |
| ğŸŸ **êµ¬ì¥ ì¡°íšŒ** | - êµ¬ì¥ ì •ë³´(ìœ„ì¹˜Â·ì¢Œì„ ìˆ˜ ë“±) ì¡°íšŒ <br> - í•´ë‹¹ êµ¬ì¥ì˜ ê²½ê¸° ì¼ì • ì¡°íšŒ <br> - ì—°ê³„ ì…”í‹€ë²„ìŠ¤ ì •ë³´ ì¡°íšŒ |



---


## ğŸ¯ ì„œë¹„ìŠ¤ ëŒ€ìƒ

- ì•¼êµ¬ ê²½ê¸°ë¥¼ ê´€ëŒí•˜ê³  ì‹¶ì€ ì¼ë°˜ ì‚¬ìš©ì
- ê²½ê¸° ì˜ˆë§¤ì™€ ì´ë™í¸(ì…”í‹€ë²„ìŠ¤)ì„ í•œ ë²ˆì— í™•ì¸í•˜ê³  ì‹¶ì–´í•˜ëŠ” ì‚¬ìš©ì
- êµ¬ë‹¨ ì •ë³´, ê²½ê¸° ì¼ì •, êµ¬ì¥ ì •ë³´ë¥¼ ë¯¸ë¦¬ ì•Œê³  ì‹¶ì–´í•˜ëŠ” ì‚¬ìš©ì
- ì‹¤ì‹œê°„ìœ¼ë¡œ ê²½ê¸° ê²°ê³¼Â·ìŠ¹ë¥ Â·ìˆœìœ„ ë“±ì„ í™•ì¸í•˜ê³  ì‹¶ì€ ì•¼êµ¬ íŒ¬
- ì—¬ëŸ¬ ì•±ì„ ì¼œì§€ ì•Šê³  í•˜ë‚˜ì˜ í”Œë«í¼ì—ì„œ ê²½ê¸° ê´€ëŒ ì¤€ë¹„ë¥¼ í•˜ê³  ì‹¶ì€ ì‚¬ìš©ì


---


## ğŸ”¥ íƒ€ ì„œë¹„ìŠ¤ì™€ì˜ ì°¨ë³„ì 

### ğŸšŒ ê²½ê¸° ì˜ˆë§¤ì™€ ì…”í‹€ë²„ìŠ¤ ì •ë³´ë¥¼ í•˜ë‚˜ì˜ ì„œë¹„ìŠ¤ì—ì„œ ì œê³µ
ê²½ê¸° ì˜ˆë§¤ì™€ ë™ì‹œì— í•´ë‹¹ ê²½ê¸°ì¥ì˜ ì…”í‹€ë²„ìŠ¤ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆëŠ”  
í†µí•©í˜• ì•¼êµ¬ ê´€ëŒ ì§€ì› ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.


---


## ğŸ¯ ê¸°ëŒ€íš¨ê³¼

### 1ï¸âƒ£ ì‚¬ìš©ì í¸ì˜ì„± í–¥ìƒ
- ê²½ê¸° ì˜ˆë§¤ì™€ ì…”í‹€ë²„ìŠ¤ ì˜ˆì•½ì„ í•œ ë²ˆì— ì²˜ë¦¬í•  ìˆ˜ ìˆì–´ ë²ˆê±°ë¡œì›€ ìµœì†Œí™”
- ê²½ê¸°ì¥ê¹Œì§€ì˜ ì´ë™ ìˆ˜ë‹¨ì„ ë¯¸ë¦¬ í™•ë³´í•˜ì—¬ ê´€ëŒ ê²½í—˜ì´ ì¾Œì í•´ì§

### 2ï¸âƒ£ ì›í™œí•œ ì´ë™ ë™ì„  í™•ë³´
- ì…”í‹€ë²„ìŠ¤ ì˜ˆì•½ìœ¼ë¡œ ê²½ê¸°ì¥ ì£¼ë³€ êµí†µ í˜¼ì¡ ì™„í™”
- ë¶ˆí•„ìš”í•œ ëŒ€ê¸°ì‹œê°„ ê°ì†Œ


---

## ğŸ“ í”„ë¡œì íŠ¸ ì£¼ìš” ì‚°ì¶œë¬¼  

ê° í•­ëª©ì€ í´ë¦­í•˜ì—¬ í™•ì¸í•˜ê±°ë‚˜ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- ğŸ“˜ **[ìš”êµ¬ì‚¬í•­ ì •ì˜ì„œ](https://docs.google.com/spreadsheets/d/1KQKxB8eO9gHyPbQbWEiC2BqMWqx1NzDDvSr9orACbNc/edit?gid=200263830#gid=200263830)**  
  í”„ë¡œì íŠ¸ ê¸°ëŠ¥ ì •ì˜ ë° ìƒì„¸ ìš”êµ¬ì‚¬í•­ ì •ë¦¬

- ğŸ“™ **[WBS (ì‘ì—… ë¶„ë¥˜ ì²´ê³„)](https://docs.google.com/spreadsheets/d/1KQKxB8eO9gHyPbQbWEiC2BqMWqx1NzDDvSr9orACbNc/edit?gid=602560201#gid=602560201)**  
  ì „ì²´ í”„ë¡œì íŠ¸ ì¼ì •ê³¼ ì‘ì—… íë¦„ êµ¬ì„±

- ğŸ—ºï¸ **ERD (Database Schema)**  
<p align="center">
  <img src="./images/MHiT_ERD.png" width="2000" alt="MHiT ERD"/>
</p>



---

### ì¿¼ë¦¬

  <details>
  <summary><b>DDL</b></summary>

```sql
 -- 1. ê´€ë¦¬ì í…Œì´ë¸” 
create table admin_list(
  admin_id varchar(36) not null primary key default (uuid()),
  admin_name varchar(255) not null, 
  admin_password varchar(255) not null);

  alter table admin_list add column is_active tinyint default 1;



 --2. ìœ ì € í…Œì´ë¸”
create table user_list(
  user_id varchar(36) not null primary key default (uuid()), 
  user_name varchar(255) not null, 
  admin_password varchar(255) not null, 
  user_phone varchar(255) not null, 
  user_email varchar(255) not null, 
  user_fav_team bigint);

alter table user_list add constraint 
  foreign key (user_fav_team) references team_list(team_id) 
  on delete set null on update cascade;

alter table user_list add column is_active tinyint default 1;


 -- 3. íŒ€ í…Œì´ë¸”
 create table team_list(
    team_id bigint auto_increment primary key, 
    ground_id bigint not null, 
    admin_id varchar(36) NOT NULL, 
    team_name varchar(255) not null, 
    foreign key(ground_id) references ground_list(ground_id), 
    foreign key(admin_id) references admin_list(admin_id));


-- 4. ê²½ê¸°ì¥ í…Œì´ë¸”
--ê²½ê¸°ì¥ ì •ë³´
create table ground_list(  
    ground_id bigint not null auto_increment,admin_id varchar(36) not null,
    area varchar(255) not null,ground_name varchar(255),
    address varchar(255) not null,seat_count bigint not null,
    primary key(ground_id),
    foreign key (admin_id) references admin(admin_id)
);

--ê²½ê¸°ì¥ ì¢Œì„ ì •ë³´
create table seat_list( 
    seat_id bigint not null auto_increment,ground_id bigint not null,
    seat_name varchar(255) not null,ground_sight varchar(255)not null,
    ground_grade varchar(255) not null,price bigint not null,
    primary key(seat_id), 
    foreign key (ground_id) references ground_list(ground_id)
);

-- 5. ê²½ê¸° í…Œì´ë¸” 
--ê²½ê¸° ì¼ì •
create table game_schedule_list( 
    game_id bigint auto_increment primary key,
    ground_id bigint not null,
    admin_id vARCHAR(36) NOT NULL,
    h_team_id bigint not null,
    a_team_id bigint not null,
    win bigint,
    foreign key(ground_id) references ground_list(ground_id),
    foreign key(admin_id) references admin_list(admin_id));

alter table game_schedule_list add column game_date datetime;
alter table game_schedule_list modify column game_date datetime not null;


-- 6. ë²„ìŠ¤ í…Œì´ë¸”
-- ë²„ìŠ¤ ì •ë³´
CREATE TABLE bus_list(
    bus_id BIGINT NOT NULL auto_increment,
    ground_id BIGINT NOT NULL,
    admin_id VARCHAR(36) NOT NULL,
    bus_seat_count INT,
    bus_num VARCHAR(20) NOT NULL UNIQUE,
    is_active TINYINT NOT NULL DEFAULT 1,
    PRIMARY KEY (bus_id),
    FOREIGN KEY (admin_id) REFERENCES admin_list (admin_id)
);

-- ë²„ìŠ¤ì‹œê°„
CREATE TABLE bus_schedule_list(
    bs_s_id BIGINT NOT NULL auto_increment,
    bus_id BIGINT NOT NULL,
    admin_id VARCHAR(36) NOT NULL,
    game_id BIGINT NOT NULL,
    schedule_time    TIMESTAMP,
    PRIMARY KEY (bs_s_id),
    FOREIGN KEY (bus_id) REFERENCES bus_list (bus_id),
    FOREIGN KEY (admin_id) REFERENCES admin_list  (admin_id),
    FOREIGN KEY (game_id) REFERENCES game_schedule_list (game_id)
);


-- 7. ì˜ˆë§¤ í…Œì´ë¸”
--ê²½ê¸° ì˜ˆë§¤ 
create table game_res_list(
    game_res_id bigint auto_increment primary key,
    user_id varchar(36) not null, 
    game_id bigint NOT NULL, 
    game_res_count bigint not null, 
    game_res_date datetime not null, 
    foreign key(user_id) references user_list(user_id), 
    foreign key(game_id) references game_schedule_list(game_id));

--ì¢Œì„ ì˜ˆë§¤
create table game_res_seat_detail(
    game_res_seat_detail_id bigint not null auto_increment,
    game_res_id bigint not null,seat_id bigint not null,
    primary key(game_res_seat_detail_id), 
    foreign key(game_res_id) references game_res_list(game_res_id),
    foreign key(seat_id) references seat_list(seat_id)
);

--ë²„ìŠ¤ ì˜ˆë§¤

CREATE TABLE bus_res_list (
    bus_res_id BIGINT NOT NULL auto_increment,
    bs_s_id BIGINT,
    user_id VARCHAR(36) NOT NULL,
    bus_res_count INT,
    PRIMARY KEY (bus_res_id),
    FOREIGN KEY (bs_s_id) REFERENCES bus_schedule_list (bs_s_id),
    FOREIGN KEY (user_id) REFERENCES user_list (user_id)
);

```
</details>

  <details>
  <summary><b>íšŒì›ê¸°ëŠ¥</b></summary>

```sql


-- 1. íšŒì›ê°€ì… í”„ë¡œì‹œì €
delimiter //
create procedure register_user(in id_name varchar(255),
in password_in varchar(255),
in phone_in varchar(255),
in email_in varchar(255), 
in fav_team_in varchar(255))
begin
    declare T_id bigint(20);
    
    -- ì¢‹ì•„í•˜ëŠ” íŒ€ ëª…ì„ ì ìœ¼ë©´ idê°’ìœ¼ë¡œ ë³€í™˜
    select team_id into T_id from team_list 
    where team_name = fav_team_in ;

    -- email ì¤‘ë³µ ì¡°íšŒ 
    if exists (
        select 1 from user_list
        where user_email = email_in
        )
        then 
			signal sqlstate '45000' 
			set message_text = "ì´ë¯¸ ë“±ë¡ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤. ";

    else 
    insert into user_list (
        user_name, user_password, user_phone, user_email, user_fav_team
    )
    values (
        id_name, password_in, phone_in, email_in, register_userT_id) ;
    end if;
end //
delimiter ;

-- 2. íšŒì›ì •ë³´ìˆ˜ì • 
delimiter //
create procedure user_info_update(in name_in varchar(255),
in password_in varchar(255),
in phone_in varchar(255),
in old_email_in varchar(255), 
in new_email_in varchar(255), 
in fav_team_in varchar(255))

begin
    declare T_id bigint(20);
    -- ì¢‹ì•„í•˜ëŠ” íŒ€ ëª…ì„ ì ìœ¼ë©´ idê°’ìœ¼ë¡œ ë³€í™˜
    select team_id into T_id 
    from team_list 
    where team_name = fav_team_in ;

    -- email ì¤‘ë³µ ì¡°íšŒ 
    if exists (
        select 1 from user_list
        where user_email = new_email_in
        )
        then 
			signal sqlstate '45000' 
			set message_text = "ì´ë¯¸ ë“±ë¡ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤. ";

    else 
    -- ì…ë ¥í•œ ê¸°ì¡´emailì´ ë§ì„ì‹œ, ìˆ˜ì •
    update user_list
    set 
        user_name=name_in, 
        user_password=password_in, 
        user_phone=phone_in, 
        user_email=new_email_in, 
        user_fav_team=T_id
        where user_email=old_email_in;
    end if;
end //
delimiter ;

-- 3. íšŒì›ì •ë³´ì¡°íšŒ
delimiter //
create procedure get_user_info(
in password_in varchar(255),
in email_in varchar(255))

begin
    select user_name, user_phone,user_email,t.team_name 
    from user_list l left join team_list t 
        on l.user_fav_team=t.team_id 
    where user_email='hong1@naver.com';
end //
delimiter ;

--íšŒì›íƒˆí‡´
delimiter //
create procedure delete_user(
in password_in varchar(255),
in email_in varchar(255))

begin
    update user_list set is_active = 0 
    where user_password=password_in and user_email=email_in;
end //
delimiter ;



```
</details>


  <details>
  <summary><b>ì¡°íšŒ</b></summary>

```sql

-- 1. êµ¬ë‹¨ì¡°íšŒ
-- êµ¬ë‹¨ì •ë³´ì¡°íšŒ
delimiter //
create procedure team_add(in team_Name varchar(255))
begin
	select t.team_name, g.area, g.ground_name, g.address, g.seat_count, s.seat_name, s.ground_sight, s.ground_grade, s.price 
    from team_list t 
    inner join ground_list g on t.ground_id=g.ground_id 
    inner join seat_list s on t.ground_id=s.ground_id 
    where t.team_name=team_Name;
end
// delimiter ;


-- êµ¬ë‹¨ê²½ê¸°ì¡°íšŒ
delimiter //
create procedure game_search(in team_Name varchar(255))
begin
	select 
    home_t.team_name as home_team,
    g.ground_name,
    away_t.team_name as away_team,
    case 
        when gs.win = 1 then 'ìŠ¹'
        when gs.win = 2 then 'íŒ¨'
        when gs.win = 0 then 'ë¬´ìŠ¹ë¶€'
        else 'ê²½ê¸° ì‹œì‘ì „'
    end as result,
    gs.game_date
from ground_list g
inner join team_list home_t 
    on g.ground_id = home_t.ground_id
inner join game_schedule_list gs 
    on g.ground_id = gs.ground_id
inner join team_list away_t
    on gs.a_team_id = away_t.team_id
    where home_t.team_name=team_Name;
end
// delimiter ;


-- êµ¬ë‹¨ ì¢‹ì•„ìš” ìˆ˜, ìŠ¹ë¥  ì •ë³´ ì¡°íšŒ
delimiter //

create procedure team_stats(
    in p_team_name varchar(255)
)
begin
    select
        t.team_id,
        t.team_name,
        count(distinct u.user_id) as fav_user_count,
        sum(
            case
                when (gs.h_team_id = t.team_id and gs.win = 1)
                     or (gs.a_team_id = t.team_id and gs.win = 2)
                then 1
                else 0
            end
        ) as wins,

        sum(
            case
                when (gs.h_team_id = t.team_id and gs.win = 2)
                     or (gs.a_team_id = t.team_id and gs.win = 1)
                then 1
                else 0
            end
        ) as losses,

        round(
            (
                sum(
                    case
                        when (gs.h_team_id = t.team_id and gs.win = 1)
                             or (gs.a_team_id = t.team_id and gs.win = 2)
                        then 1
                        else 0
                    end
                )
                /
                nullif(
                    sum(
                        case 
                            when gs.win in (1,2) then 1
                            else 0
                        end
                    ),
                    0
                ) * 100
            ),
            2
        ) as win_rate
    from team_list t
    left join user_list u on u.user_fav_team = t.team_id
    left join game_schedule_list gs on gs.h_team_id = t.team_id or gs.a_team_id = t.team_id
    where t.team_name = p_team_name
    group by
        t.team_id,
        t.team_name;
end
// delimiter ;


-- 2. êµ¬ì¥ì •ë³´ì¡°íšŒ
delimiter //

create procedure get_ground_detail(
    in p_ground_id bigint
)
begin
    select 
        ground_id,
        admin_id,
        area,
        ground_name,
        address,
        seat_count,
        ground_status
    from ground_list
    where ground_id = p_ground_id;
end//

delimiter ;


-- 3. ë²„ìŠ¤ì¡°íšŒ
-- ë²„ìŠ¤ ì •ë³´ ì¡°íšŒ
DELIMITER //

CREATE PROCEDURE show_available_bus(
    IN p_game_id BIGINT
)
BEGIN
    SELECT
        bs.bs_s_id,
        bs.game_id,
        DATE_FORMAT(gs.game_date, '%Y.%m.%d %H:%i') AS game_date,
        DATE_FORMAT(bs.schedule_time, '%Y.%m.%d %H:%i') AS bus_date,
        b.bus_id,
        b.bus_num,
        b.bus_seat_count,
        IFNULL(SUM(br.bus_res_count), 0) AS reserved_count,
        b.bus_seat_count - IFNULL(SUM(br.bus_res_count), 0) AS remain_seat
    FROM bus_schedule_list AS bs
    JOIN game_schedule_list AS gs
        ON gs.game_id = bs.game_id
    JOIN bus_list AS b
        ON b.bus_id = bs.bus_id
    LEFT JOIN bus_res_list AS br
        ON br.bs_s_id = bs.bs_s_id
    WHERE bs.game_id   = p_game_id
      AND bs.is_canceled = 0
      AND b.is_active   = 1
      AND gs.game_date  > NOW()
    GROUP BY
        bs.bs_s_id,
        bs.game_id,
        gs.game_date,
        bs.schedule_time,
        b.bus_id,
        b.bus_num,
        b.bus_seat_count
    HAVING
        b.bus_seat_count > IFNULL(SUM(br.bus_res_count), 0)
    ORDER BY
        remain_seat DESC,
        b.bus_id ASC;
END //

DELIMITER ;

-- ì˜ˆì•½ ê°€ëŠ¥í•œ ë²„ìŠ¤ ì¡°íšŒ
DELIMITER //

CREATE PROCEDURE show_available_bus(
    IN p_game_id BIGINT
)
BEGIN
    SELECT
        bs.bs_s_id,
        bs.game_id,
        DATE_FORMAT(gs.game_date, '%Y.%m.%d %H:%i') AS game_date,
        DATE_FORMAT(bs.schedule_time, '%Y.%m.%d %H:%i') AS bus_date,
        b.bus_id,
        b.bus_num,
        b.bus_seat_count,
        IFNULL(SUM(br.bus_res_count), 0) AS reserved_count,
        b.bus_seat_count - IFNULL(SUM(br.bus_res_count), 0) AS remain_seat
    FROM bus_schedule_list AS bs
    JOIN game_schedule_list AS gs
        ON gs.game_id = bs.game_id
    JOIN bus_list AS b
        ON b.bus_id = bs.bus_id
    LEFT JOIN bus_res_list AS br
        ON br.bs_s_id = bs.bs_s_id
    WHERE bs.game_id   = p_game_id
      AND bs.is_canceled = 0
      AND b.is_active   = 1
      AND gs.game_date  > NOW()
    GROUP BY
        bs.bs_s_id,
        bs.game_id,
        gs.game_date,
        bs.schedule_time,
        b.bus_id,
        b.bus_num,
        b.bus_seat_count
    HAVING
        b.bus_seat_count > IFNULL(SUM(br.bus_res_count), 0)
    ORDER BY
        remain_seat DESC,
        b.bus_id ASC;
END //

DELIMITER ;


```
</details>

  <details>
  <summary><b>ì˜ˆë§¤</b></summary>

```sql


-- 1.ê²½ê¸°ì˜ˆë§¤
CREATE PROCEDURE game_res(
    IN p_user_id        VARCHAR(36),
    IN p_game_id        BIGINT,
    IN p_game_res_count INT
)
BEGIN
    DECLARE v_dummy BIGINT;

    -- ì—ëŸ¬ ë‚˜ë©´ ìë™ìœ¼ë¡œ ë¡¤ë°±í•˜ê³  ì—ëŸ¬ ë‹¤ì‹œ ë˜ì§€ê¸°
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        ROLLBACK;
        RESIGNAL;
    END;

    START TRANSACTION;

    SELECT game_res_id
      INTO v_dummy
      FROM game_res_list
     WHERE user_id = p_user_id
       AND game_id = p_game_id
     FOR UPDATE;

    INSERT INTO game_res_list (
        user_id,
        game_id,
        game_res_count,
        game_res_date
    )
    VALUES (
        p_user_id,
        p_game_id,
        p_game_res_count,
        NOW()
    );

    COMMIT;
END //

DELIMITER ;

-- 2. ë²„ìŠ¤ì˜ˆë§¤
----- ë²„ìŠ¤ ì˜ˆì•½ -----

DELIMITER //

CREATE PROCEDURE insert_bus_reservation(
    IN p_bs_s_id       BIGINT,
    IN p_user_id       VARCHAR(36),
    IN p_bus_res_count INT
)
BEGIN
    DECLARE v_game_id          BIGINT;
    DECLARE v_bus_id           BIGINT;
    DECLARE v_is_canceled      TINYINT;
    DECLARE v_bus_seat_count   INT;
    DECLARE v_bus_is_active    TINYINT;
    DECLARE v_has_game_res     INT;
    DECLARE v_current_reserved INT;
    DECLARE v_remain           INT;
    DECLARE v_dup              INT;
    DECLARE v_msg              TEXT;

    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        ROLLBACK;
        RESIGNAL;
    END;

    START TRANSACTION;

    -- ìŠ¤ì¼€ì¤„/ê²Œì„ ì •ë³´
    SELECT game_id, bus_id, is_canceled
      INTO v_game_id, v_bus_id, v_is_canceled
      FROM bus_schedule_list
     WHERE bs_s_id = p_bs_s_id;

    IF v_game_id IS NULL THEN
        SET v_msg = 'ìœ íš¨í•˜ì§€ ì•Šì€ ë²„ìŠ¤ ìŠ¤ì¼€ì¤„ì…ë‹ˆë‹¤.';
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = v_msg;
    END IF;

    IF v_is_canceled = 1 THEN
        SET v_msg = 'ì·¨ì†Œëœ ë²„ìŠ¤ ìŠ¤ì¼€ì¤„ì…ë‹ˆë‹¤.';
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = v_msg;
    END IF;

    -- ê²½ê¸° ì˜ˆì•½ ì—¬ë¶€ í™•ì¸
    SELECT COUNT(*)
      INTO v_has_game_res
      FROM game_res_list
     WHERE user_id = p_user_id
       AND game_id = v_game_id;

    IF v_has_game_res = 0 THEN
        SET v_msg = 'ì˜ëª»ëœ ìš”ì²­ì…ë‹ˆë‹¤.';
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = v_msg;
    END IF;

    -- ë²„ìŠ¤ ê¸°ë³¸ ì •ë³´ ì¢Œì„ìˆ˜/í™œì„± ì—¬ë¶€
    SELECT bus_seat_count, is_active
      INTO v_bus_seat_count, v_bus_is_active
      FROM bus_list
     WHERE bus_id = v_bus_id;

    IF v_bus_seat_count IS NULL THEN
        SET v_msg = 'ë²„ìŠ¤ ì •ë³´ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = v_msg;
    END IF;

    IF v_bus_is_active = 0 THEN
        SET v_msg = 'ë¹„í™œì„±í™”ëœ ë²„ìŠ¤ì…ë‹ˆë‹¤.';
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = v_msg;
    END IF;

    -- bus_res_list ì ê·¸ë©´ì„œ ì²˜ë¦¬

    -- ê°™ì€ ìœ ì €ì˜ ì¤‘ë³µ ì˜ˆì•½ í™•ì¸ + ì ê¸ˆ
    SELECT COUNT(*)
      INTO v_dup
      FROM bus_res_list
     WHERE bs_s_id = p_bs_s_id
       AND user_id = p_user_id
     FOR UPDATE;

    IF v_dup > 0 THEN
        SET v_msg = 'ì´ë¯¸ ì´ ë²„ìŠ¤ë¥¼ ì˜ˆì•½í•œ ì‚¬ìš©ìì…ë‹ˆë‹¤.';
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = v_msg;
    END IF;

    -- í˜„ì¬ ì˜ˆì•½ ì¸ì› í•©ê³„ + ì ê¸ˆ
    SELECT IFNULL(SUM(bus_res_count), 0)
      INTO v_current_reserved
      FROM bus_res_list
     WHERE bs_s_id = p_bs_s_id
     FOR UPDATE;

    SET v_remain = v_bus_seat_count - v_current_reserved;

    IF p_bus_res_count > v_remain THEN
        SET v_msg = CONCAT('ì˜ˆì•½ ê°€ëŠ¥ ì¸ì›ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ë‚¨ì€ ì¢Œì„: ', v_remain);
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = v_msg;
    END IF;

    -- 5) INSERT
    INSERT INTO bus_res_list (bs_s_id, user_id, bus_res_count)
    VALUES (p_bs_s_id, p_user_id, p_bus_res_count);

    COMMIT;

    SELECT 'ë²„ìŠ¤ ì˜ˆì•½ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.' AS message,
           v_bus_id                              AS bus_id,
           p_bs_s_id                             AS bs_s_id,
           p_bus_res_count                       AS reserved_count,
           v_remain - p_bus_res_count            AS remain_seat_after;
END //

DELIMITER ;



```
</details>

  <details>
  <summary><b>ê´€ë¦¬</b></summary>

```sql

-- 1.êµ¬ë‹¨ê´€ë¦¬
-- êµ¬ë‹¨ ë“±ë¡
delimiter //
create procedure team_add(in ground_Id bigint, in admin_Id varchar(36), in team_Name varchar(255))
begin
	insert into team_list(ground_id, admin_id, team_name)
    values (ground_Id, admin_Id, team_Name);
end
// delimiter ;

-- êµ¬ë‹¨ ìˆ˜ì •
delimiter //
create procedure team_update(in ground_Name varchar(255), in team_Name varchar(255))
begin
	update team_list set ground_id=(select ground_id from ground_list where ground_name=ground_Name limit 1) where team_id=(select team_id from team_list where team_name=team_Name limit 1);
end
// delimiter ;

-- êµ¬ë‹¨ ì‚­ì œ
delimiter //
create procedure team_del(in team_Name varchar(255))
begin
	update team_list set team_status=0 where team_id=(select team_id from team_list where team_name=team_Name);
end
// delimiter ;


-- 2. êµ¬ì¥ê´€ë¦¬
-- êµ¬ì¥ ë“±ë¡
delimiter //

create procedure register_ground (
    in  p_admin_id      varchar(36),
    in  p_area          varchar(255),
    in  p_ground_name   varchar(255),
    in  p_address       varchar(255),
    in  p_seat_count    bigint,
    out p_new_ground_id bigint
)
begin
    insert into ground_list (
        admin_id,
        area,
        ground_name,
        address,
        seat_count
    ) values (
        p_admin_id,
        p_area,
        p_ground_name,
        p_address,
        p_seat_count
    );

    
    set p_new_ground_id = last_insert_id();
end//

delimiter ;

-- êµ¬ì¥ ìˆ˜ì • 
delimiter //

create procedure update_ground (
    in p_ground_id     bigint,
    in p_area          varchar(255),
    in p_ground_name   varchar(255),
    in p_address       varchar(255),
    in p_seat_count    bigint
)
begin
    update ground_list
    set 
        area = p_area,
        ground_name = p_ground_name,
        address = p_address,
        seat_count = p_seat_count
    where ground_id = p_ground_id;
end//

delimiter ;

-- êµ¬ì¥ ì‚­ì œ
delimiter //

create procedure delete_ground (
    in p_ground_id bigint
)
begin
    update ground_list
    set ground_status = 0   -- 0 = ì‚­ì œ
    where ground_id = p_ground_id;
end//

delimiter ;


-- 3.ë²„ìŠ¤ê´€ë¦¬
-- ë²„ìŠ¤ë“±ë¡
DELIMITER //

CREATE PROCEDURE insert_bus_one(
    IN p_ground_id      BIGINT,
    IN p_admin_id       VARCHAR(36),
    IN p_bus_seat_count INT,
    IN p_bus_num        VARCHAR(20)
)
BEGIN
    DECLARE v_cnt INT;

    -- ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì°¨ëŸ‰ë²ˆí˜¸ì¸ì§€ í™•ì¸
    SELECT COUNT(*)
      INTO v_cnt
      FROM bus_list
     WHERE bus_num = p_bus_num;

    -- ìˆìœ¼ë©´ ì•ˆë‚´ ë©”ì‹œì§€ë§Œ ì¶œë ¥
    IF v_cnt > 0 THEN
        SELECT CONCAT('ì´ë¯¸ ë“±ë¡ëœ ì°¨ëŸ‰ë²ˆí˜¸ì…ë‹ˆë‹¤: ', p_bus_num) AS message;

    -- ì—†ìœ¼ë©´ INSERT + ì„±ê³µ ë©”ì‹œì§€
    ELSE
        INSERT INTO bus_list (
            ground_id,
            admin_id,
            bus_seat_count,
            bus_num
        )
        VALUES (
            p_ground_id,
            p_admin_id,
            p_bus_seat_count,
            p_bus_num
        );

        SELECT CONCAT('ë²„ìŠ¤ê°€ ì •ìƒì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤: ', p_bus_num) AS message;
    END IF;
END //


-- ë²„ìŠ¤ ìˆ˜ì •
DELIMITER //

CREATE PROCEDURE update_bus_info(
    IN p_bus_id         BIGINT,
    IN p_ground_id      BIGINT,    -- NULL ì´ë©´ ë³€ê²½í•˜ì§€ ì•ŠìŒ
    IN p_bus_seat_count INT        -- NULL ì´ë©´ ë³€ê²½í•˜ì§€ ì•ŠìŒ
)
BEGIN
    UPDATE bus_list
    SET ground_id      = COALESCE(p_ground_id, ground_id),
        bus_seat_count = COALESCE(p_bus_seat_count, bus_seat_count)
    WHERE bus_id = p_bus_id;
END //

DELIMITER ;

--ë²„ìŠ¤ ì‚¬ìš©/ë¯¸ì‚¬ìš©
DELIMITER //

CREATE PROCEDURE change_bus_active(
    IN p_bus_id BIGINT
)
BEGIN
    UPDATE bus_list
    SET is_active = 1 - is_active
    WHERE bus_id = p_bus_id;
END //

DELIMITER ;

-- ë²„ìŠ¤ìŠ¤ì¼€ì¤„ë“±ë¡
DELIMITER //

CREATE PROCEDURE insert_bus_schedule(
    IN p_game_id  BIGINT,
    IN p_admin_id VARCHAR(36)   -- NULL/'' ì´ë©´ bus_list.admin_id ì‚¬ìš©
)
BEGIN
    INSERT INTO bus_schedule_list (
        bus_id,
        admin_id,
        game_id,
        schedule_time
    )
    SELECT
        b.bus_id,
        CASE
            WHEN p_admin_id IS NULL OR p_admin_id = '' THEN b.admin_id
            ELSE p_admin_id
        END AS admin_id,
        gs.game_id,
        DATE_SUB(gs.game_date, INTERVAL 1 HOUR) AS schedule_time
    FROM bus_list AS b
    JOIN game_schedule_list AS gs
        ON gs.ground_id = b.ground_id
    LEFT JOIN bus_schedule_list AS bs
        ON bs.bus_id  = b.bus_id
       AND bs.game_id = gs.game_id
    WHERE gs.game_id = p_game_id      
      AND gs.game_date > NOW()        
      AND bs.bus_id IS NULL           
      AND b.is_active = 1;            
END //

DELIMITER ;

-- ë²„ìŠ¤ìŠ¤ì¼€ì¤„ì‚­ì œ
DELIMITER //

CREATE PROCEDURE change_bus_schedule_active(
    IN p_bs_s_id BIGINT
)
BEGIN
    UPDATE bus_schedule_list
    SET is_canceled = 1 - is_canceled
    WHERE bs_s_id = p_bs_s_id;
END //

DELIMITER ;
